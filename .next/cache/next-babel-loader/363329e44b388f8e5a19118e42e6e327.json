{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"@babel/runtime/helpers/slicedToArray\");\n\nvar _regeneratorRuntime = require(\"@babel/runtime/regenerator\");\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signERC2612Permit = exports.signDaiPermit = void 0;\n\nvar rpc_1 = require(\"./rpc\");\n\nvar lib_1 = require(\"./lib\");\n\nvar MAX_INT = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';\nvar EIP712Domain = [{\n  name: \"name\",\n  type: \"string\"\n}, {\n  name: \"version\",\n  type: \"string\"\n}, {\n  name: \"chainId\",\n  type: \"uint256\"\n}, {\n  name: \"verifyingContract\",\n  type: \"address\"\n}];\n\nvar createTypedDaiData = function createTypedDaiData(message, domain) {\n  var typedData = {\n    types: {\n      EIP712Domain: EIP712Domain,\n      Permit: [{\n        name: \"holder\",\n        type: \"address\"\n      }, {\n        name: \"spender\",\n        type: \"address\"\n      }, {\n        name: \"nonce\",\n        type: \"uint256\"\n      }, {\n        name: \"expiry\",\n        type: \"uint256\"\n      }, {\n        name: \"allowed\",\n        type: \"bool\"\n      }]\n    },\n    primaryType: \"Permit\",\n    domain: domain,\n    message: message\n  };\n  return typedData;\n};\n\nvar createTypedERC2612Data = function createTypedERC2612Data(message, domain) {\n  var typedData = {\n    types: {\n      EIP712Domain: EIP712Domain,\n      Permit: [{\n        name: \"owner\",\n        type: \"address\"\n      }, {\n        name: \"spender\",\n        type: \"address\"\n      }, {\n        name: \"value\",\n        type: \"uint256\"\n      }, {\n        name: \"nonce\",\n        type: \"uint256\"\n      }, {\n        name: \"deadline\",\n        type: \"uint256\"\n      }]\n    },\n    primaryType: \"Permit\",\n    domain: domain,\n    message: message\n  };\n  return typedData;\n};\n\nvar NONCES_FN = '0x7ecebe00';\nvar NAME_FN = '0x06fdde03';\n\nvar zeros = function zeros(numZeros) {\n  return ''.padEnd(numZeros, '0');\n};\n\nvar getTokenName = function getTokenName(provider, address) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.t0 = lib_1;\n            _context.next = 3;\n            return rpc_1.call(provider, address, NAME_FN);\n\n          case 3:\n            _context.t1 = _context.sent.substr(130);\n            return _context.abrupt(\"return\", _context.t0.hexToUtf8.call(_context.t0, _context.t1));\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n};\n\nvar getDomain = function getDomain(provider, token) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var tokenAddress, _yield$Promise$all, _yield$Promise$all2, name, chainId, domain;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(typeof token !== 'string')) {\n              _context2.next = 2;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", token);\n\n          case 2:\n            tokenAddress = token;\n            _context2.next = 5;\n            return Promise.all([getTokenName(provider, tokenAddress), rpc_1.getChainId(provider)]);\n\n          case 5:\n            _yield$Promise$all = _context2.sent;\n            _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n            name = _yield$Promise$all2[0];\n            chainId = _yield$Promise$all2[1];\n            domain = {\n              name: name,\n              version: '1',\n              chainId: chainId,\n              verifyingContract: tokenAddress\n            };\n            return _context2.abrupt(\"return\", domain);\n\n          case 11:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n};\n\nexports.signDaiPermit = function (provider, token, holder, spender, expiry, nonce) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var tokenAddress, message, domain, typedData, sig;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            console.log(\"1 - JS\");\n            tokenAddress = token.verifyingContract || token;\n            console.log(\"2\");\n            _context3.t0 = holder;\n            _context3.t1 = spender;\n            _context3.t2 = nonce;\n\n            if (_context3.t2) {\n              _context3.next = 10;\n              break;\n            }\n\n            _context3.next = 9;\n            return rpc_1.call(provider, tokenAddress, \"\".concat(NONCES_FN).concat(zeros(24)).concat(holder.substr(2)));\n\n          case 9:\n            _context3.t2 = _context3.sent;\n\n          case 10:\n            _context3.t3 = _context3.t2;\n            _context3.t4 = expiry || MAX_INT;\n            message = {\n              holder: _context3.t0,\n              spender: _context3.t1,\n              nonce: _context3.t3,\n              expiry: _context3.t4,\n              allowed: true\n            };\n            console.log(\"3\");\n            _context3.next = 16;\n            return getDomain(provider, token);\n\n          case 16:\n            domain = _context3.sent;\n            console.log(\"4\");\n            typedData = createTypedDaiData(message, domain);\n            console.log(\"5\");\n            _context3.next = 22;\n            return rpc_1.signData(provider, holder, typedData);\n\n          case 22:\n            sig = _context3.sent;\n            console.log(\"6\");\n            return _context3.abrupt(\"return\", Object.assign(Object.assign({}, sig), message));\n\n          case 25:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n};\n\nexports.signERC2612Permit = function (provider, token, owner, spender) {\n  var value = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : MAX_INT;\n  var deadline = arguments.length > 5 ? arguments[5] : undefined;\n  var nonce = arguments.length > 6 ? arguments[6] : undefined;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var tokenAddress, message, domain, typedData, sig;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            tokenAddress = token.verifyingContract || token;\n            _context4.t0 = owner;\n            _context4.t1 = spender;\n            _context4.t2 = value;\n            _context4.t3 = nonce;\n\n            if (_context4.t3) {\n              _context4.next = 9;\n              break;\n            }\n\n            _context4.next = 8;\n            return rpc_1.call(provider, tokenAddress, \"\".concat(NONCES_FN).concat(zeros(24)).concat(owner.substr(2)));\n\n          case 8:\n            _context4.t3 = _context4.sent;\n\n          case 9:\n            _context4.t4 = _context4.t3;\n            _context4.t5 = deadline || MAX_INT;\n            message = {\n              owner: _context4.t0,\n              spender: _context4.t1,\n              value: _context4.t2,\n              nonce: _context4.t4,\n              deadline: _context4.t5\n            };\n            _context4.next = 14;\n            return getDomain(provider, token);\n\n          case 14:\n            domain = _context4.sent;\n            typedData = createTypedERC2612Data(message, domain);\n            _context4.next = 18;\n            return rpc_1.signData(provider, owner, typedData);\n\n          case 18:\n            sig = _context4.sent;\n            return _context4.abrupt(\"return\", Object.assign(Object.assign({}, sig), message));\n\n          case 20:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n};","map":{"version":3,"sources":["/home/jasoons/Documents/code/spikes/biconomy-tx-test/components/dist/eth-permit.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","signERC2612Permit","signDaiPermit","rpc_1","require","lib_1","MAX_INT","EIP712Domain","name","type","createTypedDaiData","message","domain","typedData","types","Permit","primaryType","createTypedERC2612Data","NONCES_FN","NAME_FN","zeros","numZeros","padEnd","getTokenName","provider","address","call","substr","hexToUtf8","getDomain","token","tokenAddress","all","getChainId","chainId","version","verifyingContract","holder","spender","expiry","nonce","console","log","allowed","signData","sig","assign","owner","deadline"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.signERC2612Permit = exports.signDaiPermit = void 0;\nconst rpc_1 = require(\"./rpc\");\nconst lib_1 = require(\"./lib\");\nconst MAX_INT = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';\nconst EIP712Domain = [\n    { name: \"name\", type: \"string\" },\n    { name: \"version\", type: \"string\" },\n    { name: \"chainId\", type: \"uint256\" },\n    { name: \"verifyingContract\", type: \"address\" },\n];\nconst createTypedDaiData = (message, domain) => {\n    const typedData = {\n        types: {\n            EIP712Domain,\n            Permit: [\n                { name: \"holder\", type: \"address\" },\n                { name: \"spender\", type: \"address\" },\n                { name: \"nonce\", type: \"uint256\" },\n                { name: \"expiry\", type: \"uint256\" },\n                { name: \"allowed\", type: \"bool\" },\n            ],\n        },\n        primaryType: \"Permit\",\n        domain,\n        message,\n    };\n    return typedData;\n};\nconst createTypedERC2612Data = (message, domain) => {\n    const typedData = {\n        types: {\n            EIP712Domain,\n            Permit: [\n                { name: \"owner\", type: \"address\" },\n                { name: \"spender\", type: \"address\" },\n                { name: \"value\", type: \"uint256\" },\n                { name: \"nonce\", type: \"uint256\" },\n                { name: \"deadline\", type: \"uint256\" },\n            ],\n        },\n        primaryType: \"Permit\",\n        domain,\n        message,\n    };\n    return typedData;\n};\nconst NONCES_FN = '0x7ecebe00';\nconst NAME_FN = '0x06fdde03';\nconst zeros = (numZeros) => ''.padEnd(numZeros, '0');\nconst getTokenName = (provider, address) => __awaiter(void 0, void 0, void 0, function* () { return lib_1.hexToUtf8((yield rpc_1.call(provider, address, NAME_FN)).substr(130)); });\nconst getDomain = (provider, token) => __awaiter(void 0, void 0, void 0, function* () {\n    if (typeof token !== 'string') {\n        return token;\n    }\n    const tokenAddress = token;\n    const [name, chainId] = yield Promise.all([\n        getTokenName(provider, tokenAddress),\n        rpc_1.getChainId(provider),\n    ]);\n    const domain = { name, version: '1', chainId, verifyingContract: tokenAddress };\n    return domain;\n});\nexports.signDaiPermit = (provider, token, holder, spender, expiry, nonce) => __awaiter(void 0, void 0, void 0, function* () {\n    console.log(\"1 - JS\")\n    const tokenAddress = token.verifyingContract || token;\n    console.log(\"2\")\n    const message = {\n      holder,\n      spender,\n      nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${holder.substr(2)}`)),\n      expiry: expiry || MAX_INT,\n      allowed: true,\n    };\n    console.log(\"3\")\n    const domain = yield getDomain(provider, token);\n    console.log(\"4\")\n    const typedData = createTypedDaiData(message, domain);\n    console.log(\"5\")\n    const sig = yield rpc_1.signData(provider, holder, typedData);\n    console.log(\"6\")\n    return Object.assign(Object.assign({}, sig), message);\n});\nexports.signERC2612Permit = (provider, token, owner, spender, value = MAX_INT, deadline, nonce) => __awaiter(void 0, void 0, void 0, function* () {\n    const tokenAddress = token.verifyingContract || token;\n    const message = {\n        owner,\n        spender,\n        value,\n        nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${owner.substr(2)}`)),\n        deadline: deadline || MAX_INT,\n    };\n    const domain = yield getDomain(provider, token);\n    const typedData = createTypedERC2612Data(message, domain);\n    const sig = yield rpc_1.signData(provider, owner, typedData);\n    return Object.assign(Object.assign({}, sig), message);\n});\n"]},"metadata":{},"sourceType":"script"}